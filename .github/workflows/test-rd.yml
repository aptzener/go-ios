on:
  push:

name: Integration tests
jobs:
  test_on_linux1:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install Go
        uses: actions/setup-go@v3
        with:
          go-version: 1.17.x
          cache: true

      - name: compile
        run: go build -o go-ios

      - name: run unit tests
        run: |
          sudo tools/device-cli&
          tools/device-cli -wait
          curl -v -X POST  localhost:3000/api/v1/devices/1e1c1389b5514b1a12e767e8a390ff3a0ad3a3e6/connect
          ./go-ios list
          ./go-ios info
          time ./go-ios screenshot
        env:
         DEVICE_DAEMON_PORT: '3000'
         ORCHESTRATOR_URL: 'https://device-orchestrator-api.onrender.com'
         API_KEY: ${{ secrets.API_KEY }}
